<% for topic in topics %>
   <div id="<%= "#{topic.id}_div" %>">
<%   if @current.nil? || @current.empty?  || (index = @current.index(topic.id.to_i)).nil? %>
<%=    render :partial => 'contracted', :object => topic, :locals => {:margin_depth => margin_depth} %>
<%   else
       @current.delete_at(index) %>
<%=    render :partial => 'expanded', :object => topic, :locals => {:margin_depth => margin_depth} %>
<%   end %>
   </div>
<% end %>